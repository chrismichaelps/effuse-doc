---
title: 国际化 (i18n)
---

# 国际化

`@effuse/i18n` 包提供类型安全的国际化支持和响应式的区域切换。

## 设置

```typescript
import { createI18n } from '@effuse/i18n';

const translations = {
	en: {
		greeting: 'Hello, {{name}}!',
		app: {
			title: 'My App',
		},
		items: {
			count_one: '{{count}} item',
			count_other: '{{count}} items',
		},
	},
	es: {
		greeting: '¡Hola, {{name}}!',
		app: {
			title: 'Mi Aplicación',
		},
		items: {
			count_one: '{{count}} elemento',
			count_other: '{{count}} elementos',
		},
	},
};

createI18n({
	defaultLocale: 'en',
	fallbackLocale: 'en',
	translations,
	detectLocale: true,
	persistLocale: true,
});
```

## 使用翻译

在组件中使用 `useTranslation` 钩子：

```tsx
import { define, computed, signal } from '@effuse/core';
import { useTranslation } from '@effuse/i18n';

const Greeting = define({
	script: () => {
		const { t, locale, setLocale } = useTranslation();
		const userName = signal('World');

		return {
			greeting: computed(() => t('greeting', { name: userName.value })),
			toggleLocale: () => setLocale(locale.value === 'en' ? 'es' : 'en'),
		};
	},
	template: ({ greeting, toggleLocale }) => (
		<div>
			<p>{greeting}</p>
			<button onClick={toggleLocale}>Change Language</button>
		</div>
	),
});
```

## 嵌套键

使用点符号访问嵌套翻译：

```typescript
const { t } = useTranslation();

t('app.title'); // "My App"
```

## 变量插值

使用 `{{variable}}` 语法传递变量：

```typescript
t('greeting', { name: 'Developer' }); // "Hello, Developer!"
```

## 复数形式

使用 `_one`、`_other`、`_zero`、`_two`、`_few`、`_many` 后缀定义复数形式：

```typescript
// 在翻译中
items: {
  count_one: '{{count}} item',
  count_other: '{{count}} items',
}

// 用法
t('items.count', { count: 1 });  // "1 item"
t('items.count', { count: 5 });  // "5 items"
```

## API 参考

### `createI18n(options)`

初始化 i18n 实例。在应用启动时调用一次。

| 选项             | 类型                | 默认值  | 描述                          |
| :--------------- | :------------------ | :------ | :---------------------------- |
| `defaultLocale`  | `string`            | —       | 使用的默认区域。              |
| `fallbackLocale` | `string`            | —       | 翻译缺失时的后备区域。        |
| `translations`   | `Record<string, T>` | —       | 按区域键入的翻译对象。        |
| `detectLocale`   | `boolean`           | `false` | 从浏览器自动检测区域。        |
| `persistLocale`  | `boolean`           | `false` | 将区域持久化到 localStorage。 |

### `useTranslation()`

返回在组件中使用的翻译工具。

| 属性        | 类型                                | 描述                   |
| :---------- | :---------------------------------- | :--------------------- |
| `t`         | `(key: string, params?) => string`  | 使用可选参数翻译键。   |
| `locale`    | `Signal<string>`                    | 当前区域的响应式信号。 |
| `setLocale` | `(locale: string) => Promise<void>` | 更改当前区域。         |
| `hasKey`    | `(key: string) => boolean`          | 检查翻译键是否存在。   |

### `getI18n()`

返回全局 i18n 实例以在组件外直接访问。

```typescript
import { getI18n } from '@effuse/i18n';

const i18n = getI18n();
i18n.setLocale('es');
```
